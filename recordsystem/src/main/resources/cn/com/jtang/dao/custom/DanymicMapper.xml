<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.jtang.dao.custom.DanymicMapper">
    <resultMap id="BaseResultMap" type="cn.com.jtang.po.custom.Common">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 30 14:06:51 CST 2016.
        -->
        <id column="id" property="id" jdbcType="VARCHAR"/>
        <result column="subject" property="subject" jdbcType="VARCHAR"/>
        <result column="recordNo" property="recordno" jdbcType="VARCHAR"/>
        <result column="sequencNo" property="sequencno" jdbcType="VARCHAR"/>
        <result column="volumeid" property="volumeid" jdbcType="VARCHAR"/>
        <result column="deadline" property="deadline" jdbcType="VARCHAR"/>
        <result column="department" property="department" jdbcType="VARCHAR"/>
        <result column="year" property="year" jdbcType="VARCHAR"/>
        <!--<result column="people" property="people" jdbcType="VARCHAR"/>-->
        <result column="createtime" property="createtime" jdbcType="TIMESTAMP"/>
        <result column="updatetime" property="updatetime" jdbcType="TIMESTAMP"/>
    </resultMap>
    <resultMap id="colMapValue" type="HashMap">
        <result property="key" column="fieldname"/>
        <result property="value" column="name"/>
    </resultMap>

    <sql id="Example_Where_Clause">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Fri Jun 03 16:32:26 CST 2016.
        -->
        <where>
            <foreach collection="example.oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" prefixOverrides="and" suffix=")">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach close=")" collection="criterion.value" item="listItem" open="("
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>

    <select id="getSelectData" parameterType="map" resultType="map">
          select * from ${tableName} where id =  #{id,jdbcType=VARCHAR};
    </select>
    <select id="getMapValue" parameterType="map" resultType="map">
          select * from ${tableName} where id =  #{id,jdbcType=VARCHAR};
    </select>
    <select id="getVolumeInner" parameterType="map" resultType="map">
        SELECT * from ${tableName} as thistable join year on thistable.year = year.id join deadline on
        thistable.deadline = deadline.id join department on thistable.department = department.id
        <if test="example != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="example.orderByClause != null">
            order by ${example.orderByClause}
        </if>
        <if test="example.start &gt; -1">
            limit #{example.start} , #{example.limit}
        </if>
    </select>
    <select id="selectAllIds" parameterType="map" resultType="String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Jun 22 14:18:55 CST 2016.
        -->
        select id from ${tableName}
    </select>
    <select id="getColMapValue" parameterType="map" resultMap="colMapValue">
        SELECT fieldname,name from tablefield where recordtypeid = #{recordTypeId,jdbcType=VARCHAR} and tabletype = #{tableFieldType,jdbcType=VARCHAR}
    </select>
    <insert id="addColumn" parameterType="java.util.Map" statementType="STATEMENT">
        ALTER TABLE ${tableName}
        <foreach collection="cols" item="col" index="index" open="" separator="," close="">
            ADD COLUMN ${col.colid} varchar(${col.colwidth}) NULL
        </foreach>;
    </insert>
    <insert id="creatTableAndInsert" parameterType="java.util.Map" statementType="STATEMENT">
        create table if not exists ${tablename}
        <foreach collection="keys" item="k" index="index" open="(" separator="," close="">
            ${k.colid} VARCHAR(${k.colwidth}) not null
        </foreach>,
        <if test="primarykey">
            PRIMARY KEY (`${primarykey}`),
        </if>
        KEY `${tableindex}` (`${foreignkey}`) USING BTREE,CONSTRAINT `${name}` FOREIGN KEY (`${foreignkey}`) REFERENCES
        `${foreignkeytable}` (`${foreignkeytablefield}`) ON DELETE CASCADE ON UPDATE CASCADE
        );

        <!--insert into ${tablename}
        <foreach collection="keys" item="k" index="index" open="(" separator="," close=")">
            ${k}
        </foreach>
        values
        <foreach collection="keys" item="k" index="index" open="(" separator="," close=")">
            '${params[k]}'
        </foreach>-->
    </insert>
    <insert id="insertInfo" parameterType="java.util.Map" statementType="STATEMENT">
        insert into ${tablename}
        <foreach collection="keys" item="k" index="index" open="(" separator="," close=")">
            ${k}
        </foreach>
        values
        <foreach collection="values" item="v" index="index" open="(" separator="," close=")">
            '${v}'
        </foreach>
    </insert>
    <insert id="insertBatch" parameterType="java.util.Map">
        insert into ${documentTable} (id,path,recordid,uploadtime)
        values
        <foreach collection="documents" item="item" index="index" separator=",">
            (#{item.id,jdbcType=VARCHAR}, #{item.path,jdbcType=VARCHAR},
            #{item.recordid,jdbcType=VARCHAR},#{item.uploadtime,jdbcType=TIMESTAMP})
        </foreach>
        <!--<foreach collection="documents" item="item" index="index" separator=",">
            (#{item.id,jdbcType=VARCHAR}, #{item.path,jdbcType=VARCHAR}, #{item.recordid,jdbcType=VARCHAR},
            #{item.uploadtime,jdbcType=TIMESTAMP})
        </foreach>-->
    </insert>

    <select id="selectObjectByRecordId" parameterType="map" resultType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Jun 26 17:31:02 CST 2016.
        -->
        select
        *
        from ${tableName}
        where recordId = #{recordId,jdbcType=VARCHAR}
    </select>
    <select id="selectPieceIdsByNos" parameterType="map" resultType="String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Jun 26 17:31:02 CST 2016.
        -->
        select
        id
        from ${tableName}
        where recordNO in
        <foreach collection="nos" item="no" index="index" separator="," open="(" close=")">
            #{no,jdbcType=VARCHAR}
        </foreach>
    </select>
    <select id="selectNosByPieceIds" parameterType="map" resultType="String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Jun 26 17:31:02 CST 2016.
        -->
        select
        recordNo
        from ${tableName}
        where id in
        <foreach collection="ids" item="id" index="index" separator="," open="(" close=")">
            #{id,jdbcType=VARCHAR}
        </foreach>
    </select>
    <select id="selectByRecordNo" parameterType="map" resultType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Jun 26 17:31:02 CST 2016.
        -->
        select
        *
        from ${tableName}
        where volumeNo = #{volumeno,jdbcType=VARCHAR}
    </select>
    <select id="selectInnerByRecordNo" parameterType="map" resultType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Jun 26 17:31:02 CST 2016.
        -->
        select
        *
        from ${tableName}
        where recordNo = #{recordNo,jdbcType=VARCHAR}
    </select>
    <select id="selectCountByCols" parameterType="map" resultType="Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Jun 26 17:31:02 CST 2016.
        -->
        select count(*) from ${tableName} as thistable
        <if test="example != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="example.orderByClause != null">
            order by ${example.orderByClause}
        </if>
    </select>
    <select id="selectByCols" parameterType="map" resultType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Jun 26 17:31:02 CST 2016.
        -->
        select
        thistable.id as targetid
        <!--  <foreach collection="cols" item="col" index="index" open="" separator="," close=","> -->
        <foreach collection="cols" item="col" index="index" open="" separator="" close="">
            <choose>
                <when test="col == 'year'|| col == 'deadline' || col == 'department'">
                    ,${col}.name as ${col}
                </when>
                <otherwise>
                    ,${col}
                </otherwise>
            </choose>
        </foreach>
        <!-- <foreach collection="indexFields" item="indexcol" index="index" open="" separator="," close=""> -->
        <foreach collection="indexFields" item="indexcol" index="index" open="" separator="" close="">
            ,${indexcol.fieldName}.name as ${indexcol.fieldName}
        </foreach>
        from ${tableName} as thistable join year on thistable.year = year.id join deadline on thistable.deadline =
        deadline.id join department on thistable.department = department.id
        <if test="indexFields !=null">
            <foreach collection="indexFields" item="indexcol" index="index">
                join ${indexcol.fieldName} on thistable.${indexcol.fieldName} = ${indexcol.fieldName}.id
            </foreach>
        </if>
        <if test="example != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="example.orderByClause != null">
            order by ${example.orderByClause}
        </if>
        <if test="example.start &gt; -1">
            limit #{example.start} , #{example.limit}
        </if>
    </select>
    <select id="selectByRecordId" parameterType="map" resultType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Jun 26 17:31:02 CST 2016.
        -->
        select
        *
        from ${tablename}
        where recordId = #{recordid,jdbcType=VARCHAR}
    </select>

    <select id="selectRecordIdsByRecordContent" parameterType="map" resultType="String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Jun 26 17:31:02 CST 2016.
        -->
        select DISTINCT
        recordId
        from ${tableName}
        where
        <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="cols" item="col" index="index" open="" separator="" close="">
                <if test="col.colvalue != ''">
                    and ${col.colid} like <![CDATA['%']]> #{col.colvalue,jdbcType=VARCHAR} <![CDATA['%']]>
                </if>
            </foreach>
        </trim>
    </select>

    <delete id="deleteOldInfo" parameterType="map">
        delete from ${tableId} where recordId = #{recordid,jdbcType=VARCHAR}
    </delete>
    <select id="countByTableId" parameterType="map" resultType="int">
        select count(*) from ${tableid}
    </select>
    <insert id="dropTable" parameterType="map" statementType="STATEMENT">
            DROP TABLE if EXISTS ${tableName}
    </insert>

</mapper>